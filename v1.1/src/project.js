require=function s(a,r,l){function c(n,e){if(!r[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(h)return h(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var o=r[n]={exports:{}};a[n][0].call(o.exports,function(e){var t=a[n][1][e];return c(t||e)},o,o.exports,s,a,r,l)}return r[n].exports}for(var h="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"074a8FsyjJG+42e/i1GcCGG","GameManager"),Object.defineProperty(n,"__esModule",{value:!0});var i,o=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),s=e("../utils/MessagePipeline");(i=s)&&i.__esModule;var a=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e)}return o(e,[{key:"resetGame",value:function(){}}]),e}());n.default=a,t.exports=n.default,cc._RF.pop()},{"../utils/MessagePipeline":"MessagePipeline"}],LongNoteChild:[function(e,t,n){"use strict";cc._RF.push(t,"20c843u4vZPlpA2RW2wDgiW","LongNoteChild");o(e("../utils/MessagePipeline"));var i=o(e("../managers/SoundManager"));function o(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{},onLoad:function(){},init:function(e){this._sound=e.sound,this._soundPlayed=!1,this.node.x=0,this.node.y=0,"LU"===e.direction?this.node.rotation=-60:"LD"===e.direction?this.node.rotation=-120:"RU"===e.direction?this.node.rotation=60:"RD"===e.direction&&(this.node.rotation=120),this._velocity=cc.v2(0,300).rotate(-this.node.rotation/180*Math.PI)},checkHitNote:function(e){this._soundPlayed||this.node._hitTest(e,this.node)&&(i.default.playSfx(this._sound),this._soundPlayed=!0)},update:function(e){var t=this._velocity.mul(e);this.node.setPosition(this.node.position.add(t)),500<Math.abs(this.node.y)&&this.node.emit("noteDelete",this.node)}}),cc._RF.pop()},{"../managers/SoundManager":"SoundManager","../utils/MessagePipeline":"MessagePipeline"}],LongNote:[function(e,t,n){"use strict";cc._RF.push(t,"66d587m69pGGpq2oGMMoXoc","LongNote");i(e("../utils/MessagePipeline")),i(e("../managers/SoundManager"));function i(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._longTapStart=!1,this._noteLenEnd=!1,this.node.on(cc.Node.EventType.TOUCH_START,this._onPress,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onRelease,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onCancel,this)},init:function(e){this._noteData=e,this.node.x=0,this.node.y=0,this.node.height=0,this._noteLenEnd=!1,this._sounds=e.sounds.concat(),this._children=[],this._touchPos=null,this._touchFinishOnce=!1,"LU"===this._noteData.direction?this.node.rotation=-60:"LD"===this._noteData.direction?this.node.rotation=-120:"RU"===this._noteData.direction?this.node.rotation=60:"RD"===this._noteData.direction&&(this.node.rotation=120),this._velocity=cc.v2(0,300).rotate(-this.node.rotation/180*Math.PI)},_onPress:function(e){this._touchFinishOnce||(this._longTapStart=!0,this._touchPos=e.getLocation())},_onMove:function(e){this._longTapStart&&(this.node._hitTest(e.getLocation(),this.node)?this._touchPos=e.getLocation():(cc.log("leave the note"),this._touchPos=null,this._touchFinishOnce=!0,this.node.emit("noteDelete",this.node)))},_onRelease:function(){this._longTapStart&&(this._touchPos=null,this._touchFinishOnce=!0)},_onCancel:function(){this._longTapStart&&(this._touchPos=null,this._touchFinishOnce=!0)},noteAdd:function(e){0!==this._sounds.length&&this._sounds[0].beat===e&&(this.node.emit("createLongNoteChild",{direction:this._noteData.direction,sound:this._sounds[0].sound,longNote:this}),this._sounds.splice(0,1))},noteEnd:function(){this._noteLenEnd=!0},addChild:function(e){this._children.push(e)},update:function(e){if(this.node.height<800&&!this._noteLenEnd&&(this.node.height=this.node.height+300*e),this._longTapStart&&this._touchPos)for(var t=0;t<this._children.length;t++)this._children[t].checkHitNote(this._touchPos);if(this._noteLenEnd){var n=this._velocity.mul(e);this.node.setPosition(this.node.position.add(n)),500<Math.abs(this.node.y)&&this.node.emit("noteDelete",this.node)}}}),cc._RF.pop()},{"../managers/SoundManager":"SoundManager","../utils/MessagePipeline":"MessagePipeline"}],MessagePipeline:[function(e,t,n){"use strict";cc._RF.push(t,"625d7RuJc5DOqpw5NUnH5Ml","MessagePipeline"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var o=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,cc.EventTarget),i(t,[{key:"sendMessage",value:function(e,t){this.emit(e,t)}}]),t}());n.default=o,t.exports=n.default,cc._RF.pop()},{}],NoteMaster:[function(e,t,n){"use strict";cc._RF.push(t,"21830PPIwZIM5zmRPRFH/Pb","NoteMaster");var i=s(e("../utils/MessagePipeline")),o=s(e("../managers/SongManager"));s(e("../managers/SoundManager"));function s(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{notePrefab:cc.Prefab,longNotePrefab:cc.Prefab,longNoteChildPrefab:cc.Prefab,loopLabel:cc.Label,tempoLabel:cc.Label,beatLabel:cc.Label,timerLabel:cc.Label,titleLabel:cc.Label,composerLabel:cc.Label},onLoad:function(){this._notePool=new cc.NodePool,this._longNotePool=new cc.NodePool,this._longNoteChildPool=new cc.NodePool,i.default.on("game:reset",this._gameReset,this)},onDestroy:function(){i.default.off("game:reset",this._gameReset,this)},_gameReset:function(){this._songData=o.default.getSong("song01"),this._baseTempo=this._songData.baseTempo,this._tempoAdjust=0,this._tempoUp=this._songData.tempoUp,this._maxTempo=this._songData.maxTempo,this._measure=this._songData.measure,this._notes=this._songData.notes,this._noteLength=this._notes.length,this._noteIndex=0,this._loopCount=0,this._bar=0,this._beat=0,this._beatPerBar=0,this._minBeat=0,this._minBeatPerBeat=0,this._minBeatTimer=0,this._songTime=0,this._beatName="1-1-1",this._dispTime(),this._dispLoop(),this._minBeatTime=0,this._setMinBeatTime(),this.titleLabel.string=this._songData.title,this.composerLabel.string=this._songData.composer,this._songStart=!0,this._songBufferEnd=!1,this._longNoteEnds={},this._longNotes=[]},update:function(e){if(this._songStart){if(this._songTime+=e,this._dispTime(),!this._songBufferEnd&&2<=this._songTime)this._songBufferEnd=!0,this._bar=1,this._beat=1,this._minBeat=1,this._doNoteEvent();else if(this._minBeatTimer+=e,this._minBeatTimer>=this._minBeatTime)this._minBeatTimer-=this._minBeatTime,this._minBeat+=1,this._minBeat>this._minBeatPerBeat&&(this._minBeat=1,this._beat+=1,this._beat>this._beatPerBar&&(this._beat=1,this._bar+=1)),this._doNoteEvent()&&(this._loopCount+=1,this._dispLoop(),this._doLoop());this._dispBeat()}},_doNoteEvent:function(){var e=!1;this._beatName=this._bar+"-"+this._beat+"-"+this._minBeat;for(var t=this._noteIndex;t<this._noteLength;t+=1){if(this._beatName!==this._notes[t].beat){this._noteIndex=t;break}var n=this._notes[t];if(void 0!==n.note)this._createNote(n.note);else if(void 0!==n.tempoAdjust)this._tempoAdjust=n.tempoAdjust,this._setMinBeatTime();else if(void 0!==n.measure)this._measure=n.measure,this._setMinBeatTime();else if(void 0!==n.loopTo){var i=n.loopTo.split("-");this._bar=Number(i[0]),this._beat=Number(i[1]),this._minBeat=Number(i[2]),e=!0;break}}if(this._longNoteEnds[this._beatName]){var o=this._longNoteEnds[this._beatName];if(0<o.length){for(var s=0;s<o.length;s++)o[s].noteEnd();delete this._longNoteEnds[this._beatName]}}for(var a=0;a<this._longNotes.length;a++)this._longNotes[a].noteAdd(this._beatName);return e},_doLoop:function(){this._noteIndex=0,this._beatName=this._bar+"-"+this._beat+"-"+this._minBeat;for(var e=0;e<this._noteLength;e+=1)if(this._beatName===this._notes[e].beat){this._noteIndex=e;break}this._baseTempo=Math.min(this._baseTempo+this._tempoUp,this._maxTempo),this._doNoteEvent()},_createNote:function(e){var t=this._getNote(e.type).getComponent(e.type);t&&(t.init(e),"LongNote"===e.type&&(this._longNoteEnds[e.noteEnd]||(this._longNoteEnds[e.noteEnd]=[]),this._longNoteEnds[e.noteEnd].push(t),this._longNotes.push(t)))},_createLongNoteChild:function(e){var t=e.detail,n=void 0;0<this._longNoteChildPool.size()?n=this._longNoteChildPool.get():(n=cc.instantiate(this.longNoteChildPrefab)).on("noteDelete",this._noteDelete,this),n.parent=this.node;var i=n.getComponent("LongNoteChild");i.init(t),t.longNote.addChild(i)},_getNote:function(e){var t=void 0,n=void 0;return"Note"===e?(this._notePool,n=this.notePrefab):"LongNote"===e&&(this._longNotePool,n=this.longNotePrefab),cc.log(this._notePool.size()),(t=cc.instantiate(n)).on("noteDelete",this._noteDelete,this),"LongNote"===e&&t.on("createLongNoteChild",this._createLongNoteChild,this),t.parent=this.node,t},_noteDelete:function(e){var t=e.detail;"Note"===t.name?this._notePool.put(t):"LongNote"===t.name&&this._longNotePool.put(t)},_setMinBeatTime:function(){var e=this._measure.split("-"),t=60/(this._baseTempo+this._tempoAdjust);this._beatPerBar=e[0],this._minBeatPerBeat=e[1],this._minBeatTime=t/e[1],this._dispTempo()},_dispLoop:function(){this.loopLabel.string="LOOP:"+(this._loopCount+1)},_dispTempo:function(){this.tempoLabel.string="TEMPO:"+(this._baseTempo+this._tempoAdjust)},_dispBeat:function(){this.beatLabel.string=this._beatName},_dispTime:function(){this.timerLabel.string=("0"+Math.floor(this._songTime/60)).slice(-2)+":"+("0"+Math.floor(this._songTime%60)).slice(-2)+"."+this._getDecimalPlace(this._songTime)},_getDecimalPlace:function(e){if("number"!=typeof e)return null;var t=0,n=e.toString().split(".");return n[1]?t=(n[1]+"00").substr(0,2):n="00",t}}),cc._RF.pop()},{"../managers/SongManager":"SongManager","../managers/SoundManager":"SoundManager","../utils/MessagePipeline":"MessagePipeline"}],Note:[function(e,t,n){"use strict";cc._RF.push(t,"061710nXltB4rKzKrQBaviJ","Note");o(e("../utils/MessagePipeline"));var i=o(e("../managers/SoundManager"));function o(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onPress,this)},onDestroy:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onPress,this)},init:function(e){this._noteData=e,this.node.x=0,this.node.y=0,"LU"===this._noteData.direction?this.node.rotation=-60:"LD"===this._noteData.direction?this.node.rotation=-120:"RU"===this._noteData.direction?this.node.rotation=60:"RD"===this._noteData.direction&&(this.node.rotation=120),this._velocity=cc.v2(0,300).rotate(-this.node.rotation/180*Math.PI)},_onPress:function(){i.default.playSfx(this._noteData.sound),this.node.emit("noteDelete",this.node)},update:function(e){var t=this._velocity.mul(e);this.node.setPosition(this.node.position.add(t)),500<Math.abs(this.node.y)&&this.node.emit("noteDelete",this.node)}}),cc._RF.pop()},{"../managers/SoundManager":"SoundManager","../utils/MessagePipeline":"MessagePipeline"}],ScreenController:[function(e,t,n){"use strict";cc._RF.push(t,"031e0joJGxGdoThyqSJYqJP","ScreenController"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._canvas||this.screenFit()},screenFit:function(){if(this._canvas=this.getComponent(cc.Canvas),window.innerWidth/window.innerHeight>this._canvas.designResolution.width/this._canvas.designResolution.height){this._canvas.fitHeight=!0,this._canvas.fitWidth=!1;var e=document.getElementById("Cocos2dGameContainer");e&&(e.style.padding="0px")}}}),cc._RF.pop()},{}],SongManager:[function(e,t,n){"use strict";cc._RF.push(t,"d16b1FuvH5Cc4q3pzoN3onc","SongManager"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var o=new(function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._songs={}}return i(e,[{key:"loadSongs",value:function(){var i=this;return new Promise(function(n,e){cc.loader.loadRes("json/songs.json",function(e,t){e?n({}):(i._songs=t,n(t))})})}},{key:"getSong",value:function(e){return this._songs[e]?this._songs[e]:null}}]),e}());n.default=o,t.exports=n.default,cc._RF.pop()},{}],SoundManager:[function(e,t,n){"use strict";cc._RF.push(t,"a6e97Fm/ehNlKElrge2Sa/0","SoundManager"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var r="musicneon:volume:bgm",l="musicneon:volume:sfx",c=10,s=/\/([^\/|.]*)\.(?:mp3)/,o=new(function(){function t(){var e=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this._audioBgms={},this._audioSfxs={},cc.audioEngine.setMaxAudioInstance(c),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){e._playingClips=[],cc.log("stop all sound"),cc.audioEngine.stopAll()})}return i(t,[{key:"loadAllAudio",value:function(){var o=this,e=[],t=new Promise(function(n,i){cc.loader.loadResDir("audio/bgm",cc.AudioClip,function(e,t){e?i(e):(t.forEach(function(e){var t=s.exec(e)[1];o._audioBgms[t]=e}),n())})}),n=new Promise(function(n,i){cc.loader.loadResDir("audio/sfx",cc.AudioClip,function(e,t){e?i(e):(t.forEach(function(e){var t=s.exec(e)[1];o._audioSfxs[t]=e}),n())})});return e.push(t),e.push(n),Promise.all(e)}},{key:"_getBGMVolume",value:function(){var e=cc.sys.localStorage.getItem(r);return e?parseFloat(e):1}},{key:"_getSfxVolume",value:function(){var e=cc.sys.localStorage.getItem(l);return e?parseFloat(e):1}},{key:"setBGMVolume",value:function(e){var t=!0,n=!1,i=void 0;try{for(var o,s=this._playingClips[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var a=o.value;this._audioBgms[a.id]&&cc.audioEngine.setVolume(a.clip,void 0===e?a.volume:e)}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}cc.sys.localStorage.setItem(r,e)}},{key:"setSfxVolume",value:function(e){var t=!0,n=!1,i=void 0;try{for(var o,s=this._playingClips[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var a=o.value;this._audioSfxs[a.id]&&cc.audioEngine.setVolume(a.clip,void 0===e?a.volume:e)}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}cc.sys.localStorage.setItem(l,e)}},{key:"muteAll",value:function(){this._updateVolume(0)}},{key:"unmuteAll",value:function(){this._updateVolume()}},{key:"_updateVolume",value:function(e){var t=!0,n=!1,i=void 0;try{for(var o,s=this._playingClips[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var a=o.value;cc.audioEngine.setVolume(a.clip,void 0===e?a.volume:e)}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}}},{key:"stopBGM",value:function(e){this._audioBgms[e]&&this.stop(e)}},{key:"stopSfx",value:function(e){this._audioSfxs[e]&&this.stop(e)}},{key:"stop",value:function(e){for(var t=this._playingClips.length;0<=t;t--){var n=this._playingClips[t];n?n.id===e&&(cc.audioEngine.stop(n.clip),this._playingClips.splice(t,1)):this._playingClips.splice(t,1)}}},{key:"playBGM",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=this._audioBgms[e];i&&(n*=this._getBGMVolume(),this.play(e,i,t,n))}},{key:"playSfx",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=this._audioSfxs[e];i&&(n*=this._getSfxVolume(),this.play(e,i,t,n))}},{key:"play",value:function(t,e,n,i){var o=this,s=this._playingClips.find(function(e){return e.id===t});if(!s||this.canPlayNew(t,n,i,s)){if(cc.sys.OS_ANDROID===cc.sys.os&&this._playingClips.length>c){var a=this._playingClips.findIndex(function(e){return!e.loop}),r=this._playingClips.splice(a,1);cc.audioEngine.stop(r[0].clip)}var l=cc.audioEngine.play(e,n,i);cc.audioEngine.setFinishCallback(l,function(){var e=o._playingClips.findIndex(function(e){return e.id===t&&e.clip===l});o._playingClips.splice(e,1)}),this._playingClips.push({id:t,clip:l,loop:n,volume:i})}}},{key:"canPlayNew",value:function(e,t,n,i){if(t^i.loop)return cc.warn("╮(๑•́ ₃•̀)╭"),!1;if(t&&0===cc.audioEngine.getVolume(i.clip))return cc.audioEngine.setVolume(i.clip,n),!1;if(t)return!1;if(cc.sys.OS_ANDROID!==cc.sys.os)return!0;var o=0,s=!0,a=!1,r=void 0;try{for(var l,c=this._playingClips[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){o+=l.value.id===e?1:0}}catch(e){a=!0,r=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw r}}return!(4<=o)||(cc.audioEngine.setVolume(i.clip,n),!1)}},{key:"isEnableBGM",get:function(){return 0<this._getBGMVolume()}},{key:"isEnableSfx",get:function(){return 0<this._getSfxVolume()}}]),t}());n.default=o,t.exports=n.default,cc._RF.pop()},{}],StateController:[function(e,t,n){"use strict";cc._RF.push(t,"4b134IqlQRCQYYlA2O7f2Qm","StateController");var i=a(e("../utils/MessagePipeline")),o=a(e("../managers/SoundManager")),s=a(e("../managers/SongManager"));function a(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=[o.default.loadAllAudio(),s.default.loadSongs()];Promise.all(e).then(function(){i.default.sendMessage("game:reset")})}}),cc._RF.pop()},{"../managers/SongManager":"SongManager","../managers/SoundManager":"SoundManager","../utils/MessagePipeline":"MessagePipeline"}]},{},["ScreenController","StateController","LongNote","LongNoteChild","Note","NoteMaster","GameManager","SongManager","SoundManager","MessagePipeline"]);